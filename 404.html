systemInstruction: { parts: [{ text: "You are an expert crypto market analyst named CB-AI. Provide only market analysis, predictions, and education." }] }
                };

                const response = await fetch(GEMINI_API_URL + GEMINI_API_KEY, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Error: Could not retrieve AI advice. Check console for details.";
                responseElement.textContent = text;

            } catch (error) {
                console.error("Gemini API Error:", error);
                responseElement.textContent = `[API Error: Network issue or invalid response from the AI service. Check the console for full error details.]`;
            } finally {
                aiButton.disabled = false;
                aiButton.textContent = 'Get CB-AI Analysis';
            }
        }


        // --- Final Setup on Document Load ---
        window.onload = function () {
            // Load wallet state before starting the app
            loadWallet();

            // Start fetching prices and periodic updates
            startDataServices();

            // Show the main application immediately
            showApp();

            // Setup navigation event listeners
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', (e) => switchTab(e.currentTarget.getAttribute('data-tab')));
            });

            // Setup feature event listeners
            document.getElementById('buy-button').addEventListener('click', () => executeTrade('BUY'));
            document.getElementById('sell-button').addEventListener('click', () => executeTrade('SELL'));
            document.getElementById('send-button').addEventListener('click', sendMessage);
            document.getElementById('chat-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') { sendMessage(); }
            });
            document.getElementById('ai-button').addEventListener('click', fetchAIAdvice);

            // Set initial tab
            switchTab('trade');
        };
    </script>
</body>
</html>


    
                 
        
                    

                                

